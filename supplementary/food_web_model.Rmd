---
title: "Mechanistic model"
author: "Piotr Szefer"
date: "1/18/2023"
output: html_document
---

To investigate further what are the possible outcomes and mechanisms in our experiment we build a mechanistic RM model based on (McCann). The model we use is as follows:

$$ \begin{matrix} \frac{dP}{dt} = rP \left( 1-\frac{P}{K} \right)-\frac{\Omega_{HP}x_{H}y_{H}PH}{P+P_0} \\ 
\frac{dH}{dt} = -x_HH\left(1-\frac{\Omega_{HP}y_HP}{P+P0}\right)-\frac{\Omega_{SH}x_{S}y_SHS}{H+H_0}-\frac{\Omega_{BH}y_Bx_BHB}{o_{BH}H+(1-\Omega_{BH})S+H_0} \\ 
 dS = -x_SS \left( 1- \frac{\Omega_{SH}y_SH}{H+H_0}\right)- \frac{(1-\Omega_{BH})y_Bx_BSB}{\Omega_{BH}H+(1-\Omega_{BH})S+H_0} \\
    dB = -x_BB \left( 1-\frac{\Omega_{BH}y_BH+(1-\Omega_{BH})y_BS}{\Omega_{BH}H+(1-\Omega_{BH})S+H_0)} \right) \end{matrix}$$

```{r}
library(deSolve)
# Define full model
fullModule <- function(t, state, parameters) {
  with(as.list(c(state, parameters)),{
    dP <-  r*P*(1-P/K)-(o_HP*x_H*y_H*P*H)/(P+P0)
    dH <- -x_H*H*(1-(o_HP*y_H*P)/(P+P0))-(o_SH*x_S*y_S*H*S)/(H+H0)-(o_BH*y_B*x_B*H*B)/(o_BH*H+(1-o_BH)*S+H0)
    dS <- -x_S*S*(1-(o_SH*y_S*H)/(H+H0))-((1-o_BH)*y_B*x_B*S*B)/(o_BH*H+(1-o_BH)*S+H0)
    dB <- -x_B*B*(1-(o_BH*y_B*H+(1-o_BH)*y_B*S)/(o_BH*H+(1-o_BH)*S+H0))
    list(c(dP,dH,dS,dB))
  })
}

params <- c(r = 1         ,
            K = 1       , # environmental 
            
            
            o_BS = 0.7    , # preference of birds for spiders
            o_BH = 0.3    , # preference of birds for herbivores
            o_HP = 1      , # preference of herbivores for plants
            o_SH = 1      , # preference of spiders for herbivores
            
            
            x_H  = 0.2    ,
            x_B  = 0.08   ,
            x_S  = 0.5    ,
            
            y_H  = 2.009  ,
            y_B  = 5      ,
            y_S  = 3.5    ,
            
            P0   = 0.16129,
            H0   = 0.9
            
            ) 

state <- c(P = 0.5, H = 0.5, S = 0.5, B = 0.5)
times <- seq(0,500, by = 0.1)

out <- ode(y = state, times = times, func = fullModule, parms = params)

matplot(out[,-1], type = "l")
plot(log(out[dim(out)[1],-1]))
```

Now that we have a functioning moel we can try to scan the parameter space of interaction strength as it was done in the mentioned paper. 

Interaction strength was calculated as $$ \alpha_{i,j} $$